"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}require(["./config"],function(){require(["template","header","footer","kefu"],function(e,n){new(function(){function t(){_classCallCheck(this,t),this.render(),this.clearAll()}return _createClass(t,[{key:"render",value:function(){var t=localStorage.getItem("cart");t?(this.cart=JSON.parse(t),$("#shop_tbody").html(e("shop_tbody_template",{cart:this.cart})),this.carOperate()):($("#cart-empty").show(),$("#shopping_car").hide())}},{key:"carOperate",value:function(){this.calcTotalMoney(),this.setAllCheckStatus(),this.checksChange(),this.allCheckChange(),this.plus(),this.minus(),this.remove(),this.valueChange(),this.checkBgChange()}},{key:"calcTotalMoney",value:function(){var t=this.cart.reduce(function(t,e){return e.check&&(t+=e.price*e.count),t},0);0===t?($("#indent").parent().css("background","#666"),$("#indent").bind("click",function(t){t.preventDefault()})):($("#indent").parent().css("background","#ed3029"),$("#indent").unbind("click")),$("#Paymoney").html(t.toFixed(2))}},{key:"setAllCheckStatus",value:function(){var t=this.cart.every(function(t){return t.check});$("#all-check").prop("checked",t),n.calcTotalCount()}},{key:"checksChange",value:function(){n.calcTotalCount();var t=this;$(".checks").on("change",function(){var e=$(this).prop("checked"),c=$(this).parents("tr").data("id");t.cart=t.cart.map(function(t){return t.goodid===c&&(t.check=e),t}),localStorage.setItem("cart",JSON.stringify(t.cart)),t.setAllCheckStatus(),t.calcTotalMoney(),t.checkBgChange()})}},{key:"allCheckChange",value:function(){n.calcTotalCount();var t=this;$("#all-check").on("change",function(){var c=$(this).prop("checked");console.log(c),t.cart=t.cart.map(function(t){return t.check=c,t}),localStorage.setItem("cart",JSON.stringify(t.cart)),$(".checks").each(function(t,e){$(e).prop("checked",c)}),t.setAllCheckStatus(),t.calcTotalMoney(),t.checkBgChange()})}},{key:"checkBgChange",value:function(){$("#all-check").prop("checked")?$("#all-check").css("background","url(https://js01.daoju.qq.com/zb/lolriotmall/pc/images/member/buy_inphoer.jpg) no-repeat"):$("#all-check").css("background","none"),$(".checks").each(function(t,e){$(e).prop("checked")?$(e).css("background","url(https://js01.daoju.qq.com/zb/lolriotmall/pc/images/member/buy_inphoer.jpg) no-repeat"):$(e).css("background","none")})}},{key:"remove",value:function(){var a=this;$(".del").on("click",function(){var c=$(this).parents("tr").data("id");confirm("确定要删除吗？")&&(a.cart.forEach(function(t,e){a.cart[e].goodid===c&&a.cart.splice(e,1)}),localStorage.setItem("cart",JSON.stringify(a.cart)),n.calcTotalCount(),0===a.cart.length&&localStorage.removeItem("cart"),a.render(),a.setAllCheckStatus(),a.calcTotalMoney())})}},{key:"plus",value:function(){var t=this;$(".plus").on("click",function(){var e=$(this).parents("tr").data("id");t.cart=t.cart.map(function(t){return t.goodid===e&&(t.count+=1,5<t.count&&alert("Are you ok?")),t}),localStorage.setItem("cart",JSON.stringify(t.cart)),t.calcTotalMoney(),t.render()}),n.calcTotalCount()}},{key:"minus",value:function(){var t=this;$(".minus").on("click",function(){var e=$(this).parents("tr").data("id");t.cart=t.cart.map(function(t){return t.goodid===e&&(t.count--,t.count<1&&(t.count=1)),t}),localStorage.setItem("cart",JSON.stringify(t.cart)),t.calcTotalMoney(),t.render()}),n.calcTotalCount()}},{key:"valueChange",value:function(){var t=this;$(".amount").on("change",function(){var e=this,c=$(this).parents("tr").data("id");console.log(c),t.cart=t.cart.map(function(t){return t.goodid===c&&(t.count=+$(e).prop("value"),console.log(t.count),t.count<1&&(t.count=1),5<t.count&&alert("Are you ok?")),t}),localStorage.setItem("cart",JSON.stringify(t.cart)),t.calcTotalMoney(),t.render(),t.setAllCheckStatus()})}},{key:"clearAll",value:function(){var t=this;$("#clear").on("click",function(){confirm("确定要清空吗？")&&(localStorage.removeItem("cart"),t.render(),n.calcTotalCount())})}}]),t}())})});